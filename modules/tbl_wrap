#!/bin/sh
#
# Create a C++ skeleton to implement new XLR primitives

usage() {
    echo "Usage: $0 -o <outfile> <infile>"
    echo ""
    echo "Generate a C++ skeleton to implement new XLR primitives."
    echo "Example: $0 -o example_wrap.cpp example.tbl"
}

if [ $# = 0 ] ; then
    usage
	exit 1
fi

while [ "$1" ]
do
    if [ "$1" = "-o" ]; then
        OUT="$2"
        if [ -z "$OUT" ] ; then
            echo "$0: $1: missing file name"
            exit 1
        fi
        shift 2
    elif [ "$1" = "-h" ]; then
        usage
        exit 0
    else
        IN=$1
        shift
    fi
done

DATE=`date`

cat >$OUT << __EOF__
/*
 * Generated by $0 from $IN
 * $DATE
 */
#include "opcodes.h"
#include "types.h"
#include "runtime.h"
#include "options.h"
#include "main.h"
#include <iostream>

using namespace XL;

#include "opcodes_declare.h"
#include "$IN"

void enter_symbols(XL::Symbols *c)
{
    XL::Main *main = MAIN;
#include "opcodes_define.h"
#include "$IN"
}


void delete_symbols()
{
#include "opcodes_delete.h"
#include "$IN"
}
__EOF__
